# typed: false
# frozen_string_literal: true

# This file was generated by Homebrew and is not meant to be edited directly.
# For details, see: https://docs.brew.sh/Formula-Cookbook

class Schoolcode < Formula
  desc "Automated developer tool deployment for macOS Guest accounts"
  homepage "https://github.com/luka-loehr/SchoolCode"
  url "https://github.com/luka-loehr/SchoolCode/archive/refs/tags/v3.0.0.tar.gz"
  sha256 "661722ef85c5059b92b86cce1e130ee4d6991dbfe742c3c659baa15ea61092a0" # Will be calculated after creating release
  license "Apache-2.0"
  head "https://github.com/luka-loehr/SchoolCode.git", branch: "main"

  depends_on "bash"

  def install
    # Install main script as executable
    bin.install "schoolcode.sh" => "schoolcode"
    
    # Install all scripts to libexec/scripts
    libexec.install Dir["scripts"]
    
    # Make all scripts executable
    Dir["#{libexec}/**/*.sh"].each { |f| chmod 0755, f }
  end

  def post_install
    # Run SchoolCode installation script
    # This will perform full installation: compatibility check, system repair, tool installation, guest setup
    system "sudo", "#{bin}/schoolcode"
  end

  def uninstall
    # Run SchoolCode uninstall script before removing package
    if File.exist?("#{bin}/schoolcode")
      system "sudo", "#{bin}/schoolcode", "--uninstall"
    end
  end

  test do
    # Test that the command exists and shows help
    system "#{bin}/schoolcode", "--help"
  end
end

